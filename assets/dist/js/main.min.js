(function(){
    "use strict";

    [].forEach.call(document.querySelectorAll('collapsible'), function(module){
        [].forEach.call(module.querySelectorAll('dt'), function(header){
            header.onclick = function() {
                header.classList.toggle('open');
                header.nextSibling.classList.toggle('open');
            };
        });
    });
})();

/*

  Table of Contents
  -----

*/
(function(){
    "use strict";

    var html = '', level = 0,
        navigation = document.createElement('nav'),
        // The placeholder can be element, like `document.body` for instance
        placeholder = document.getElementsByClassName('navigation')[0];

    [].forEach.call(document.querySelectorAll('h1, h2, h3, h4, h5, h6'), function(header){
        if (header.id && header.id !== 'undefined') {
            /*
                Build Navigation markup
            */
            var current = header.tagName.substring(1);

            if (current > level) {
                html += '<ul class="level-' + current + '">';
            } else if (current === level) {
                html += '</li>';
            } else {
                html += '</li></ul></li>';
            }
            html += '<li class="level-' + current + '"><a href="#' + header.id + '">' + header.innerText + '</a>';
            level = current;

            /*
                Add anchor to all header with proper id
            */
            var anchor = document.createElement('a');

            anchor.href = '#' + header.id;
            anchor.innerHTML = header.innerHTML;
            header.innerHTML = '';
            header.appendChild(anchor);
        }
    });

    html += '</li></ul>';
    navigation.innerHTML = html;
    // This appends the navigation in the placeholder
    placeholder.insertBefore(navigation,placeholder.firstChild);
})();

/**
Module Slideshow
=====

The Slideshow module is a very simple slider that will switch between child elements with fade effect.

The first `slide` must have the class `active`.

__Template markup:__

```
<module class="slideshow" data-module="slideshow">
    <!-- loop of slides -->
    <div class="slide" data-index="0">
        ...
    </div>
    <!-- end of loop of slides -->

    <nav class="nav">
        <button class="prev">prev</button>
        <button class="next">next</button>
    </nav>

    <nav class="control">
        <!-- loop of slides -->
            <button data-index="0">â€¢</button>
        <!-- end of loop of slides -->
    </nav>
</module>
```

__Style required:__

```
.slideshow {
    position: relative;

    .slide {
        display: none;
        opacity: 0;
        position: relative;
        transition: opacity 2s;
        width: 100%;
        z-index: 1;

        &.active {
            display: block;
            opacity: 1;
            transition: opacity 2s;
            z-index: 2;
        }
    }

    .nav {
        position: absolute;
        top: 50%;
        width: 100%;
        z-index: 3;

        .prev {
            float: left;
        }

        .next {
            float: right;
        }
    }

    .control {
        bottom: -20px;
        position: absolute;
        text-align: center;
        width: 100%;
        z-index: 4;
    }

    &.initialized {
        .slide {
            display: block;
            position: absolute;
        }
    }
}

```

*/
(function(){
    "use strict";

    [].forEach.call(document.querySelectorAll('slideshow'), function(module){
        
        var index = 0, interval = 0,
            slides = module.querySelectorAll("slide"),
            nav = module.getElementsByClassName("nav")[0],
            prev = nav.getElementsByClassName("prev")[0],
            next = nav.getElementsByClassName("next")[0],
            control = module.getElementsByClassName("control")[0],
            controlItens = control.getElementsByClassName("control-item");

        function setHeight(){
            module.style.height = slides[index].offsetHeight + "px";
        }

        function buildControl(){
            [].forEach.call(controlItens, function (controlItem) {
                controlItem.addEventListener("click", function () {
                    switchSlide(this.dataset.index);
                }, false);
            });
        }

        function buildNavigation(){
            prev.onclick = function() {
                switchSlide("prev");
            };

            next.onclick = function() {
                switchSlide("next");
            };
        }

        function switchSlide(action){
            clearInterval(interval);
            interval = 0;

            slides[index].classList.remove("active");
            controlItens[index].classList.remove("active");

            if (action === "prev") {
                index = index === 0 ? slides.length - 1 : index - 1;
            } else if (action === "next") {
                index = index === slides.length - 1 ? 0 : index + 1;
            } else {
                index = parseInt(action);
            }

            slides[index].classList.add("active");
            controlItens[index].classList.add("active");
            module.dataset.index = index;

            setHeight();

            interval = setInterval(function (){
                switchSlide("next");
            }, 5000);
        }

        if (slides.length > 1) {
            window.addEventListener("resize", setHeight);
        }

        buildControl();
        buildNavigation();
        setHeight();

        slides[0].classList.add("active");
        controlItens[0].classList.add("active");

        module.dataset.index = index;
        module.classList.add("initialized");

        interval = setInterval(function (){
            switchSlide("next");
        }, 5000);
    });

/*
        var slider = document.getElementsByClassName("js-slider"),

        

        if (slider.length > 0) {
            slides = slider[0].getElementsByClassName("slide");
            control = slider[0].getElementsByClassName("control");
            controlItens = control[0].getElementsByTagName("button");

            if (slides.length > 1) {
                window.addEventListener("resize", setHeight);

                buildControl();
                buildNavigation();
                setHeight();

                slides[0].classList.add("active");
                controlItens[0].classList.add("active");

                slider[0].dataset.index = index;
                slider[0].classList.add("initialized");

                interval = setInterval(function (){
                    switchSlide("next");
                }, 5000);
            }
        }
*/

})();
